<ng-container *ngIf="!deleted">
  <div
    class="feedback-card"
    [class.expanded]="expanded"
    (click)="toggleExpanded()"
  >
    <div class="feedback-header">
      <div class="party from">
        <div class="party-label">From</div>
        <div class="party-name">{{ fromName }}</div>
      </div>

      <div class="arrow">→</div>

      <div class="party to">
        <div class="party-label">To</div>
        <div class="party-name">{{ toName }}</div>
      </div>

      <div class="meta">
        <span class="meta-label">Created At</span>
        <span class="meta-date">{{ createdAtLocal }}</span>
        <span class="toggle-label">
          {{ expanded ? 'Hide details' : 'Show details' }}
        </span>
        <span class="chevron" [class.up]="expanded">⌃</span>
      </div>
    </div>

    <div class="feedback-details" *ngIf="expanded">
      <div class="grades" *ngIf="hasGrades">
        <div class="section-title">Grades</div>
        <div class="grades-grid">
          <div class="grade-item">
            <span class="grade-label">Career Skills</span>
            <span class="grade-value">{{ feedback.grade?.careerSkills }}/5</span>
          </div>
          <div class="grade-item">
            <span class="grade-label">Communication</span>
            <span class="grade-value">{{ feedback.grade?.communication }}/5</span>
          </div>
          <div class="grade-item">
            <span class="grade-label">Collaboration</span>
            <span class="grade-value">{{ feedback.grade?.collaboration }}/5</span>
          </div>
        </div>
      </div>

      <div class="comment-block">
        <div class="comment-header">
          <div class="section-title">Comment</div>

          <button
            class="reqdel-btn"
            *ngIf="showRequestDelete"
            (click)="onRequestDeleteClick($event)">
            Request delete
          </button>

          <button
            class="delete-btn"
            *ngIf="showDelete"
            type="button"
            [disabled]="deleting || confirmLoading"
            (click)="onDeleteClick($event)">
            {{ deleting ? 'Deleting…' : 'Delete' }}
          </button>
        </div>

        <p class="comment-text">
          {{ feedback.comment }}
        </p>
      </div>
    </div>
  </div>

  <app-request-delete
    *ngIf="feedback"
    [open]="requestOpen"
    [feedbackId]="feedback.id"
    (closed)="onRequestClosed($event)">
  </app-request-delete>

  <app-confirm-delete
    *ngIf="confirmOpen"
    [title]="confirmTitle"
    [message]="confirmMessage"
    [confirmLabel]="confirmLabel"
    [cancelLabel]="cancelLabel"
    [loading]="confirmLoading"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()">
  </app-confirm-delete>
</ng-container>
