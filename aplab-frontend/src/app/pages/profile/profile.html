<app-navbar></app-navbar>

<div class="profile-wrap">
  <h2 class="title">My Profile</h2>

  <section class="profile-card" [class.is-editing]="isEditing" *ngIf="!loading; else loadingTpl">
    <div class="header">
      <div class="avatar">
        {{ (displayName ?? email ?? 'U').substring(0,1) | uppercase }}
      </div>
      <div class="id-block">
        <h3>{{ displayName || '—' }}</h3>
        <p class="muted">{{ email || '—' }}</p>
        <span class="role-badge" [class.admin]="role==='admin'"
                                  [class.mentor]="role==='mentor'"
                                  [class.intern]="role==='intern'"
                                  [class.guest]="role==='guest'">{{ role | uppercase }}</span>
      </div>
    </div>

    <div class="divider"></div>

    <div class="info-grid">
      <div class="info-item editable">
        <span class="label">Full name</span>
        <ng-container *ngIf="!isEditing; else fullNameEdit">
          <span class="value">{{ displayName || '—' }}</span>
        </ng-container>
        <ng-template #fullNameEdit>
          <input class="input" type="text" [(ngModel)]="fullNameInput" name="fullName" required />
        </ng-template>
      </div>

      <div class="info-item">
        <span class="label">Email</span>
        <span class="value">{{ email || '—' }}</span>
      </div>

      <div class="info-item wide editable">
        <span class="label">Description</span>
        <ng-container *ngIf="!isEditing; else descEdit">
          <span class="value">{{ description || '—' }}</span>
        </ng-container>
        <ng-template #descEdit>
          <textarea class="textarea" rows="4" [(ngModel)]="descInput" name="description"></textarea>
        </ng-template>
      </div>
    </div>

    <div class="actions">
      <a class="btn-ghost" routerLink="/dashboard" *ngIf="role !== 'guest' && !isEditing">Dashboard</a>
      <button class="btn-primary" (click)="edit()" *ngIf="!isEditing">Edit profile</button>
      <a href="#" (click)="openPasswordChange($event)" *ngIf="isEditing" class="btn-ghost">Change your password?</a>
      <button class="btn-ghost" (click)="cancel()" *ngIf="isEditing">Cancel</button>
      <button class="btn-primary" (click)="save()" [disabled]="saving || !fullNameInput?.trim()" *ngIf="isEditing">
        {{ saving ? 'Saving…' : 'Save changes' }}
      </button>
    </div>
  </section>

  <ng-template #loadingTpl>
    <section class="profile-card loading-card">
      <ui-spinner class="grid-spinner" [size]="32" [thickness]="4"></ui-spinner>
      <div class="skeleton header-skel"></div>
      <div class="divider"></div>
      <div class="skeleton row"></div>
      <div class="skeleton row"></div>
      <div class="skeleton row wide"></div>
      <div class="actions">
        <div class="skeleton btn"></div>
        <div class="skeleton btn"></div>
      </div>
    </section>
  </ng-template>
</div>
